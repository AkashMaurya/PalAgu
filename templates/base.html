<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches) }" 
      x-bind:class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PAL Program - Arabian Gulf University{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#E6F0FF',
                            100: '#CCE0FF',
                            500: '#0066FF',
                            600: '#0052CC',
                            900: '#003D99'
                        },
                        'primary-dark': {
                            50: '#0A1929',
                            100: '#1A2F45',
                            500: '#3399FF',
                            600: '#0066FF',
                            900: '#E6F0FF'
                        },
                        neutral: {
                            50: '#FAFAFA',
                            100: '#F5F5F5',
                            200: '#E5E5E5',
                            300: '#D4D4D4',
                            500: '#A3A3A3',
                            700: '#404040',
                            900: '#171717'
                        },
                        'neutral-dark': {
                            50: '#0D1117',
                            100: '#161B22',
                            200: '#21262D',
                            300: '#30363D',
                            500: '#6E7681',
                            700: '#C9D1D9',
                            900: '#F0F6FC'
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* Design system tokens (from UI design) */
        :root {
          --color-primary-50: #eef2ff;
          --color-primary-100: #e0e7ff;
          --color-primary-200: #c7d2fe;
          --color-primary-300: #a5b4fc;
          --color-primary-400: #818cf8;
          --color-primary-500: #6366f1;
          --color-primary-600: #4f46e5;
          --color-primary-700: #4338ca;
          --color-primary-800: #3730a3;
          --color-primary-900: #312e81;

          --color-accent-50: #d1fae5;
          --color-accent-100: #a7f3d0;
          --color-accent-200: #6ee7b7;
          --color-accent-300: #34d399;
          --color-accent-400: #10b981;
          --color-accent-500: #059669;
          --color-accent-600: #047857;

          --color-secondary-50: #f5f3ff;
          --color-secondary-100: #ede9fe;
          --color-secondary-200: #ddd6fe;
          --color-secondary-300: #c4b5fd;
          --color-secondary-400: #a78bfa;
          --color-secondary-500: #8b5cf6;
          --color-secondary-600: #7c3aed;

          --color-info-50: #f0f9ff;
          --color-info-100: #e0f2fe;
          --color-info-500: #0ea5e9;
          --color-info-600: #0284c7;

          --color-warning-50: #fffbeb;
          --color-warning-100: #fef3c7;
          --color-warning-500: #f59e0b;
          --color-warning-600: #d97706;

          --color-error-50: #fef2f2;
          --color-error-100: #fee2e2;
          --color-error-500: #ef4444;
          --color-error-600: #dc2626;

          --color-success-50: #d1fae5;
          --color-success-100: #a7f3d0;
          --color-success-500: #10b981;
          --color-success-600: #059669;

          --color-neutral-50: #f8fafc;
          --color-neutral-100: #f1f5f9;
          --color-neutral-200: #e2e8f0;
          --color-neutral-300: #cbd5e1;
          --color-neutral-400: #94a3b8;
          --color-neutral-500: #64748b;
          --color-neutral-600: #475569;
          --color-neutral-700: #334155;
          --color-neutral-800: #1e293b;
          --color-neutral-900: #0f172a;

          --color-background: #fff;
          --color-background-secondary: var(--color-neutral-50);
          --color-background-tertiary: var(--color-neutral-100);
          --color-surface: #fff;
          --color-surface-hover: var(--color-neutral-50);
          --color-border: var(--color-neutral-200);
          --color-border-strong: var(--color-neutral-300);

          --color-text-primary: var(--color-neutral-900);
          --color-text-secondary: var(--color-neutral-600);
          --color-text-tertiary: var(--color-neutral-500);
          --color-text-disabled: var(--color-neutral-400);
          --color-text-inverse: #fff;

          --shadow-sm: 0 1px 2px 0 #0000000d;
          --shadow-base: 0 1px 3px 0 #0000001a, 0 1px 2px -1px #0000001a;
          --shadow-md: 0 4px 6px -1px #0000001a, 0 2px 4px -2px #0000001a;
          --shadow-lg: 0 10px 15px -3px #0000001a, 0 4px 6px -4px #0000001a;
          --shadow-xl: 0 20px 25px -5px #0000001a, 0 8px 10px -6px #0000001a;

          --spacing-0: 0;
          --spacing-1: .125rem;
          --spacing-2: .25rem;
          --spacing-3: .5rem;
          --spacing-4: .75rem;
          --spacing-5: 1rem;
          --spacing-6: 1.5rem;
          --spacing-7: 2rem;
          --spacing-8: 2.5rem;
          --spacing-9: 3rem;
          --spacing-10: 4rem;

          --radius-sm: .375rem;
          --radius-base: .5rem;
          --radius-md: .625rem;
          --radius-lg: .75rem;
          --radius-xl: 1rem;
          --radius-full: 9999px;

          --focus-ring: 0 0 0 3px var(--color-primary-100);
        }

        .dark {
          --color-background: var(--color-neutral-900);
          --color-background-secondary: var(--color-neutral-800);
          --color-background-tertiary: var(--color-neutral-700);
          --color-surface: var(--color-neutral-800);
          --color-surface-hover: var(--color-neutral-700);
          --color-border: var(--color-neutral-700);
          --color-border-strong: var(--color-neutral-600);
          --color-text-primary: var(--color-neutral-50);
          --color-text-secondary: var(--color-neutral-300);
          --color-text-tertiary: var(--color-neutral-400);
          --color-text-disabled: var(--color-neutral-500);
          --shadow-sm: 0 1px 2px 0 #00000080;
          --shadow-base: 0 1px 3px 0 #00000080, 0 1px 2px -1px #00000080;
          --shadow-md: 0 4px 6px -1px #00000080, 0 2px 4px -2px #00000080;
          --shadow-lg: 0 10px 15px -3px #00000080, 0 4px 6px -4px #00000080;
          --shadow-xl: 0 20px 25px -5px #00000080, 0 8px 10px -6px #00000080;
          --focus-ring: 0 0 0 3px var(--color-primary-800);
        }

        body {
          font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Dark mode transition */
        * {
          transition: background-color 150ms ease-in-out, color 150ms ease-in-out, border-color 150ms ease-in-out;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
          * {
            animation-duration: 0.01ms !important;
            transition-duration: 0.01ms !important;
          }
        }

        /* Responsive page container */
        .grid-container {
          width: 100%;
          margin-left: auto;
          margin-right: auto;
          padding-left: 1rem;
          padding-right: 1rem;
        }
        @media (min-width: 768px) {
          .grid-container {
            padding-left: 2rem;
            padding-right: 2rem;
          }
        }
        @media (min-width: 1440px) {
          .grid-container {
            max-width: 1440px;
          }
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen bg-[var(--color-background)] text-[var(--color-text-primary)] transition-colors">
    {% block body %}
    {% if user.is_authenticated %}
    <!-- Navigation -->
    <nav class="sticky top-0 z-40 bg-[var(--color-surface)] border-b border-[var(--color-border)] shadow-sm">
        <div class="grid-container">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-8">
                    <a href="{% url 'dashboard' %}" class="text-xl font-semibold text-neutral-900 dark:text-neutral-dark-900">
                        PAL Program
                    </a>
                    
                    <div class="hidden md:flex space-x-4">
                        {% if user.role == 'Admin' %}
                        <a href="{% url 'admin_dashboard' %}" class="px-3 py-2 rounded-md text-sm font-medium text-neutral-700 dark:text-neutral-dark-700 hover:text-primary-500 dark:hover:text-primary-dark-500">
                            Dashboard
                        </a>
                        <a href="{% url 'user_management' %}" class="px-3 py-2 rounded-md text-sm font-medium text-neutral-700 dark:text-neutral-dark-700 hover:text-primary-500 dark:hover:text-primary-dark-500">
                            Users
                        </a>
                        <a href="{% url 'analytics' %}" class="px-3 py-2 rounded-md text-sm font-medium text-neutral-700 dark:text-neutral-dark-700 hover:text-primary-500 dark:hover:text-primary-dark-500">
                            Analytics
                        </a>
                        <a href="{% url 'settings' %}" class="px-3 py-2 rounded-md text-sm font-medium text-neutral-700 dark:text-neutral-dark-700 hover:text-primary-500 dark:hover:text-primary-dark-500">
                            Settings
                        </a>
                        {% elif user.role == 'Manager' %}
                        <a href="{% url 'manager_analytics' %}" class="px-3 py-2 rounded-md text-sm font-medium text-neutral-700 dark:text-neutral-dark-700 hover:text-primary-500 dark:hover:text-primary-dark-500">
                            Analytics
                        </a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button @click="darkMode = !darkMode; localStorage.setItem('theme', darkMode ? 'dark' : 'light')" 
                            class="p-2 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-dark-200">
                        <i x-show="!darkMode" data-lucide="sun" class="w-5 h-5"></i>
                        <i x-show="darkMode" data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                    
                    <!-- User Menu -->
                    <div x-data="{ open: false }" class="relative">
                        <button @click="open = !open" class="flex items-center space-x-2 p-2 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-dark-200">
                            <span class="text-sm font-medium">{{ user.get_full_name }}</span>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        
                        <div x-show="open" @click.away="open = false" 
                             class="absolute right-0 mt-2 w-48 bg-neutral-100 dark:bg-neutral-dark-100 border border-neutral-200 dark:border-neutral-dark-200 rounded-lg shadow-lg py-1 z-50">
                            <div class="px-4 py-2 border-b border-neutral-200 dark:border-neutral-dark-200">
                                <p class="text-xs text-neutral-500 dark:text-neutral-dark-500">{{ user.email }}</p>
                                <p class="text-xs text-neutral-500 dark:text-neutral-dark-500">Role: {{ user.role }}</p>
                            </div>
                            <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-neutral-700 dark:text-neutral-dark-700 hover:bg-neutral-200 dark:hover:bg-neutral-dark-200">
                                Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    {% endif %}
    
    <!-- Messages -->
    {% if messages %}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
        {% for message in messages %}
        <div class="mb-4 p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200{% elif message.tags == 'success' %}bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200{% else %}bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>
    {% endblock %}
    
    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
        
        // Reinitialize icons after HTMX swaps
        document.body.addEventListener('htmx:afterSwap', () => {
            lucide.createIcons();
        });
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
